-- Tạo bảng lưu trữ thông tin sách
CREATE TABLE Book (
    google_book_id VARCHAR(50) PRIMARY KEY,  -- ID từ Google Books API làm khóa chính
    title VARCHAR(255) NOT NULL,
    published_date VARCHAR(20),
    authors TEXT,
    category TEXT,
    description TEXT,
    thumbnail_url VARCHAR(255),
    page_count INT,
    quantity int,
    state varchar(20),
    -- state : publishing or deleted
    language VARCHAR(10)
) COLLATE utf8mb4_bin;


-- Bảng User
CREATE TABLE User (
    user_id VARCHAR(20) PRIMARY KEY,
    fullName varchar(50),
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    state VARCHAR(20) DEFAULT 'active'
)COLLATE utf8mb4_bin;


-- Tạo bảng feedback để chứa đánh giá của người dùng về sách
CREATE TABLE Feedback (
    feedback_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(20),
    google_book_id VARCHAR(50),
    rating INT CHECK (rating BETWEEN 1 AND 5),
    comment TEXT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES User(user_id),
    FOREIGN KEY (google_book_id) REFERENCES Book(google_book_id)
)COLLATE utf8mb4_bin;

-- Tạo bảng lịch sử mượn trả chung cho tất cả user (Chỉ admin có thể xem)
CREATE TABLE BookLoans (
    history_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(20),
    google_book_id VARCHAR(50),
    borrow_date DATE NOT NULL,
    return_date DATE,
    state VARCHAR(20),
    note TEXT,
    FOREIGN KEY (user_id) REFERENCES User(user_id),
    FOREIGN KEY (google_book_id) REFERENCES Book(google_book_id)
)COLLATE utf8mb4_bin;

CREATE TABLE Admin (
    admin_id VARCHAR(20) PRIMARY KEY,
    fullName varchar(50),
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL
)COLLATE utf8mb4_bin;

-- Bảng xử lý phiên thao tác admin với user (Đăng ký, sửa, xóa)
CREATE TABLE AdminUser (
    action_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id VARCHAR(20),
    admin_id VARCHAR(20),
    action_type VARCHAR(50),  -- Đăng ký, sửa, xóa
    date DATE,
    FOREIGN KEY (user_id) REFERENCES User(user_id),
    FOREIGN KEY (admin_id) REFERENCES Admin(admin_id)
)COLLATE utf8mb4_bin;

-- Bảng xử lý phiên thao tác admin với sách (Sửa, xóa, thêm, tăng giảm số lượng, v.v.)
CREATE TABLE AdminBook (
    action_id INT AUTO_INCREMENT PRIMARY KEY,
    google_book_id VARCHAR(50),
    admin_id VARCHAR(20),
    quantity int,
    action VARCHAR(50),  -- Sửa, xóa, thêm, tăng giảm số lượng
    date DATE,
    FOREIGN KEY (google_book_id) REFERENCES Book(google_book_id),
    FOREIGN KEY (admin_id) REFERENCES Admin(admin_id)
)COLLATE utf8mb4_bin;


create table BookRcm (
	rcm_id int auto_increment primary key,
    google_book_id varchar(50),
    user_id varchar(20),
    FOREIGN KEY (google_book_id) REFERENCES Book(google_book_id),
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    state varchar(20)
    -- state : in queue or accepted
)COLLATE utf8mb4_bin;
